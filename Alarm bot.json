{"files":[{"id":"f7b9b111-7e11-45f6-be5f-931832e112d3","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Taipei\",\n  \"dependencies\": {\n  },\n  \"webapp\": {\n    \"access\": \"ANYONE_ANONYMOUS\",\n    \"executeAs\": \"USER_DEPLOYING\"\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"e2f02cdc-45c1-4ebb-9ecb-c5326ac7c8ab","name":"程式碼","type":"server_js","source":"//程式碼開始\n\nvar Line_Notify_Token \u003d \"rRVdldkXDlQJfFwpsRTey11no0REJ36x3GpSzA8X4sN\";\nvar CHANNEL_ACCESS_TOKEN \u003d \"HFAjD4gjWDYzRGC5xlvRxAhTPfmjUzjJda8IuRxszJiQ/0LFHJm9ZBMFLU5uO4e56dPSi9oazpRI24FXjDasxY0AEp9Pqg7gwBUJ8tFY+AcSKYfazsCESD4lrkNVU6q7lnSbSLV33qjg2w5xVP2blQdB04t89/1O/w1cDnyilFU\u003d\";\nvar spreadSheetID \u003d \"1WxMq8Dh533wk-YjdRVafZItguadS6RFzqyFVM-rIiEQ\";\nvar myID \u003d \"Ucaa8d9316a44ed30c98cc1c81b2edf6c\";\nvar confirmMessage \u003d \"您所輸入的資料如下：\";\nvar cancelMessage \u003d \"您所輸入的資料已取消。\";\nvar welcomeTitle \u003d \"定時提醒系統，請輸入相關資料進行設定：\";\nvar finishTitle \u003d \"設定完成，時間到了會發出 Line 訊息通知您。\";\nvar ignoreWord \u003d [\"help\", \"?\", \"？\"];\nvar stopAlarmWord \u003d \"ok\";    //停止提醒用的關鍵字\nvar showDataDays \u003d 7;    //顯示多少天內的提醒資料\nvar showDataListWord \u003d \"list\";    //啟動顯示指定天數內資料的命令\nvar deleteShowDataPostback \u003d \"DeleteAlertData：\";    //檢查是否是「要刪除的提醒事項」的關鍵字\nvar confirmDeleteShowDataPostback \u003d \"confirmDeleteData：\";    //確實「刪除的提醒事項」的關鍵字\nvar spreadSheet \u003d SpreadsheetApp.openById(spreadSheetID);\nvar sheet \u003d spreadSheet.getActiveSheet();\nvar lastRow \u003d sheet.getLastRow();\nvar lastColumn \u003d sheet.getLastColumn();\nvar sheetData \u003d sheet.getSheetValues(1, 1, lastRow, lastColumn);\n//接收使用者訊息\nfunction doPost(e) {\n  var userData \u003d JSON.parse(e.postData.contents);\n// 取出 replayToken 和發送的訊息文字\n  var replyToken \u003d userData.events[0].replyToken;\n  var userId \u003d userData.events[0].source.userId;\n   \n  if (userId !\u003d myID) {return;}\n  try {\n    var clientMessage \u003d userData.events[0].message.text;\n    for (var i \u003d 0; i \u003c ignoreWord.length; i++) {\n      if (clientMessage.toLowerCase() \u003d\u003d ignoreWord[i].toLowerCase()) { return; }\n    }\n    if (clientMessage.toLowerCase() \u003d\u003d stopAlarmWord.toLowerCase()) {\n      stopAlarm(userId);\n      return;\n    }\n    if (clientMessage.toLowerCase() \u003d\u003d showDataListWord.toLowerCase()) {\n      showDataInDays(CHANNEL_ACCESS_TOKEN, userId, replyToken, showDataDays);\n      return;\n    }\n    var replyData \u003d getUserAnswer(userId, clientMessage);\n  }\n  catch(err) {\n    var clientMessage \u003d userData.events[0].postback.data;\n    switch (clientMessage) {\n      case \"DateTimeMessage\":\n        clientMessage \u003d userData.events[0].postback.params.datetime;\n        var replyData \u003d getUserAnswer(userId, clientMessage);\n        break;\n      default:\n        if (clientMessage.indexOf(deleteShowDataPostback) !\u003d -1){\n          var deleteShowDataPostbackNum \u003d clientMessage.split(\"：\");\n          checkDeleteShowData(CHANNEL_ACCESS_TOKEN, userId, deleteShowDataPostbackNum[1], replyToken);\n        }\n        if (clientMessage.indexOf(confirmDeleteShowDataPostback) !\u003d -1){\n          var deleteShowDataPostbackNum \u003d clientMessage.split(\"：\");\n          confirmDeleteShowData(CHANNEL_ACCESS_TOKEN, userId, deleteShowDataPostbackNum[1], replyToken);\n        }\n        var replyData \u003d checkConfirmData(CHANNEL_ACCESS_TOKEN, userId, clientMessage, replyToken);\n    }\n  }\n  var QandO \u003d [sheetData[0], sheetData[1], sheetData[replyData[0] - 1]];\n  switch (replyData[1]) {\n    case -2:\n      return;\n    case -1:\n      var replyMessage \u003d [];\n      replyMessage.push({type:\"text\", text:cancelMessage});\n      break;\n    case 0:\n      var replyMessage \u003d {confirmTitle:confirmMessage, confirmTime:QandO[2][1], confirmContent:clientMessage};\n      sendConfirmMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage);\n      return;\n    case 1:\n      var replyMessage \u003d [];\n      replyMessage.push({type:\"text\", text:finishTitle});\n      break;\n    case 2:\n      var replyMessage \u003d {welcomeMessage:welcomeTitle, questionDescription:QandO[1][replyData[1] - 1]};\n      sendDateTimeMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage);\n      return;\n    case 3:\n      var replyMessage \u003d {question:QandO[0][replyData[1] - 1], questionDescription:QandO[1][replyData[1] - 1]};\n      sendContentMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage);\n      return\n  }\n  sendReplyMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage);\n}\n//判斷使用者回答到第幾題\nfunction getUserAnswer(userId, clientMessage) {\n  var returnData \u003d [];\n  for (var i \u003d 0; i \u003c lastRow; i++) {\n    if (sheetData[i][0] \u003d\u003d userId \u0026\u0026 sheetData[i][lastColumn - 1] \u003d\u003d \"\") {\n      for (var j \u003d 1; j \u003c\u003d lastColumn -1; j++) {\n        if (sheetData[i][j] \u003d\u003d\u003d \"\") {break;}\n      }\n      sheet.getRange(i + 1, j + 1).setValue(clientMessage);\n      //如果使用者已經回答了最後一題，就把完成時間填上。不然就送出下一題給使用者\n      if (j + 3 \u003d\u003d lastColumn) {\n        returnData \u003d [i + 1, 0];\n      }\n      else {\n        returnData \u003d [i + 1, j + 2];\n      }\n      return returnData;\n      break;\n    }\n  }\n  //如果使用者還沒有回答過任何資料，就新增加一列在最後，把使用者ID輸入並開始送出題目\n  sheet.insertRowAfter(lastRow);\n  sheet.getRange(lastRow + 1, 1).setValue(userId);\n  returnData \u003d [lastRow + 1, 2];\n  return returnData;\n}\n//把「是否提醒」數值調成1\nfunction stopAlarm(userId) {\n  var TimeNow \u003d new Date();\n  for (var i \u003d 2; i \u003c lastRow; i++) {\n    if (sheetData[i][0] \u003d\u003d userId \u0026\u0026 sheetData[i][3] \u003d\u003d 0) {\n      var startTime \u003d new Date(sheetData[i][1]);\n      if (startTime \u003c TimeNow) {\n        sheet.getRange(i + 1, 4).setValue(\"1\");\n      }\n    }\n  }  \n}\n//取得需要發送的訊息\nfunction getAlarmData() {\n  var TimeNow \u003d new Date();\n  var pushContents \u003d [];\n  var j \u003d 0;\n  for (var i \u003d 2; i \u003c lastRow; i++) {\n    if (sheetData[i][3] \u003d\u003d\u003d 0) {\n      var startTime \u003d new Date(sheetData[i][1]);\n      if (startTime \u003c TimeNow) {\n        pushContents[j] \u003d sheetData[i][2];\n        j++;\n      }\n    }\n  }\n  if (pushContents.length !\u003d 0) {\n    for (var i \u003d 0; i \u003c 5; i++) {\n      for (var j \u003d 0; j \u003c pushContents.length; j++) {\n        sendLineNotify(\"\\n\\n\" + pushContents[j], Line_Notify_Token)\n      }\n      Utilities.sleep(1000);\n    }\n  }\n}\n//回送 Line Bot 訊息給使用者\nfunction sendReplyMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage) {\n  var url \u003d \"https://api.line.me/v2/bot/message/reply\";\n  UrlFetchApp.fetch(url, {\n    \"headers\": {\n      \"Content-Type\": \"application/json; charset\u003dUTF-8\",\n      \"Authorization\": \"Bearer \" + CHANNEL_ACCESS_TOKEN,\n    },\n    \"method\": \"post\",\n    \"payload\": JSON.stringify({\n      \"replyToken\": replyToken,\n      \"messages\": replyMessage,\n    }),\n  });\n}\n//分析確認按鈕按下的時機\nfunction checkConfirmData(CHANNEL_ACCESS_TOKEN, userId, clientMessage, replyToken) {\n  var returnData \u003d [];\n  for (var i \u003d lastRow - 1; i \u003e\u003d 0; i--) {\n    if (sheetData[i][0] \u003d\u003d userId \u0026\u0026 sheetData[i][lastColumn - 3] !\u003d\u003d \"\" \u0026\u0026 sheetData[i][lastColumn - 1] \u003d\u003d \"\") {\n      if (clientMessage \u003d\u003d \"DecideConfirm\") {\n        sheet.getRange(i + 1, lastColumn - 1).setValue(0);\n        sheet.getRange(i + 1, lastColumn).setValue(Date());\n        returnData \u003d [i + 1, 1];\n      }\n      else if (clientMessage \u003d\u003d \"DecideCancel\"){\n        returnData \u003d [i + 1, -1];\n        sheet.deleteRow(i + 1);\n      }\n      return returnData;\n      break;\n    }\n  }\n  //使用者亂按舊的確認或刪除按鈕時的處理方式\n  returnData \u003d [1, -2];\n  return returnData;  \n}\n//傳送選擇日期時間按鈕給使用者\nfunction sendDateTimeMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage) {\n  var sendMessage \u003d [];\n  //製作 Flex Message\n  var flexMessage \u003d [];\n  flexMessage.push({\n    \"type\": \"bubble\",\n    \"body\": {\n      \"type\": \"box\",\n      \"layout\": \"vertical\",\n      \"contents\": [\n        {\n          \"type\": \"text\",\n          \"text\": replyMessage.questionDescription,\n          \"weight\": \"bold\",\n          \"size\": \"xl\"\n        }\n      ]\n    },\n    \"footer\": {\n      \"type\": \"box\",\n      \"layout\": \"vertical\",\n      \"spacing\": \"sm\",\n      \"contents\": [\n        {\n          \"type\": \"button\",\n          \"style\": \"primary\",\n          \"action\": {\n            \"type\": \"datetimepicker\",\n            \"label\": \"點選按鈕設定時間\",\n            \"data\": \"DateTimeMessage\",\n            \"mode\": \"datetime\"\n          }\n        }\n      ]\n    }\n  });\n  sendMessage.push({\n    \"type\": \"text\",\n    \"text\": replyMessage.welcomeMessage\n  },\n  {\n    \"type\": \"flex\",\n    \"altText\": \"時間設定\",\n    \"contents\": {\n      \"type\": \"carousel\",\n      \"contents\": flexMessage\n    }\n  });\n  sendReplyMessage(CHANNEL_ACCESS_TOKEN, replyToken, sendMessage);\n}\n//傳送轉寫提醒內容訊息\nfunction sendContentMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage){\n  var sendMessage \u003d [];\n  //製作 Flex Message\n  var flexMessage \u003d [];\n  flexMessage.push({\n    \"type\": \"bubble\",\n    \"body\": {\n      \"type\": \"box\",\n      \"layout\": \"vertical\",\n      \"contents\": [\n        {\n          \"type\": \"text\",\n          \"text\": replyMessage.question,\n          \"weight\": \"bold\",\n          \"size\": \"xl\"\n        },\n        {\n          \"type\": \"box\",\n          \"layout\": \"vertical\",\n          \"margin\": \"xl\",\n          \"spacing\": \"xl\",\n          \"contents\": [\n            {\n              \"type\": \"box\",\n              \"layout\": \"baseline\",\n              \"spacing\": \"xl\",\n              \"contents\": [\n                {\n                  \"type\": \"text\",\n                  \"text\": replyMessage.questionDescription,\n                  \"color\": \"#aaaaaa\",\n                  \"size\": \"lg\",\n                  \"wrap\": true\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  });\n  sendMessage.push({\n    \"type\": \"flex\",\n    \"altText\": \"請輸入要提醒的事項\",\n    \"contents\": {\n      \"type\": \"carousel\",\n      \"contents\": flexMessage\n    }\n  });\n  sendReplyMessage(CHANNEL_ACCESS_TOKEN, replyToken, sendMessage);\n}\n//傳送確認按鈕給使用者\nfunction sendConfirmMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage) {\n  var sendMessage \u003d [];\n  //製作 Flex Message\n  var flexMessage \u003d [];\n  flexMessage.push({\n    \"type\": \"bubble\",\n    \"body\": {\n      \"type\": \"box\",\n      \"layout\": \"vertical\",\n      \"contents\": [\n        {\n          \"type\": \"text\",\n          \"text\": replyMessage.confirmTitle,\n          \"weight\": \"bold\",\n          \"size\": \"xl\"\n        },\n        {\n          \"type\": \"box\",\n          \"layout\": \"vertical\",\n          \"margin\": \"xl\",\n          \"spacing\": \"xl\",\n          \"contents\": [\n            {\n              \"type\": \"box\",\n              \"layout\": \"baseline\",\n              \"spacing\": \"xl\",\n              \"contents\": [\n                {\n                  \"type\": \"text\",\n                  \"text\": \"提醒事項\",\n                  \"color\": \"#aaaaaa\",\n                  \"size\": \"md\",\n                  \"flex\": 2\n                },\n                {\n                  \"type\": \"text\",\n                  \"text\": replyMessage.confirmContent,\n                  \"wrap\": true,\n                  \"color\": \"#666666\",\n                  \"size\": \"md\",\n                  \"flex\": 5\n                }\n              ]\n            },\n            {\n              \"type\": \"box\",\n              \"layout\": \"baseline\",\n              \"spacing\": \"xl\",\n              \"contents\": [\n                {\n                  \"type\": \"text\",\n                  \"text\": \"提醒時間\",\n                  \"color\": \"#aaaaaa\",\n                  \"size\": \"md\",\n                  \"flex\": 2\n                },\n                {\n                  \"type\": \"text\",\n                  \"text\": replyMessage.confirmTime,\n                  \"wrap\": true,\n                  \"color\": \"#666666\",\n                  \"size\": \"md\",\n                  \"flex\": 5\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    \"footer\": {\n      \"type\": \"box\",\n      \"layout\": \"vertical\",\n      \"spacing\": \"sm\",\n      \"contents\": [\n        {\n          \"type\": \"button\",\n          \"style\": \"primary\",\n          \"action\": {\n            \"type\": \"postback\",\n            \"label\": \"確認\",\n            \"data\": \"DecideConfirm\"\n          }\n        },\n        {\n          \"type\": \"button\",\n          \"style\": \"secondary\",\n          \"action\": {\n            \"type\": \"postback\",\n            \"label\": \"取消\",\n            \"data\": \"DecideCancel\"\n          }\n        }\n      ]\n    }\n  });\n  sendMessage.push({\n    \"type\": \"flex\",\n    \"altText\": \"確認資料\",\n    \"contents\": {\n      \"type\": \"carousel\",\n      \"contents\": flexMessage\n    }\n  });\n  sendReplyMessage(CHANNEL_ACCESS_TOKEN, replyToken, sendMessage);\n}\n//顯示出設定天數內的提醒事項\nfunction showDataInDays(CHANNEL_ACCESS_TOKEN, userId, replyToken, showDataDays) {\n  var url \u003d \"https://api.line.me/v2/bot/message/reply\";\n  //取出資料庫中距離現在「設定天數」內的尚未提醒事項\n  var showData \u003d [];\n  var today \u003d new Date();\n  var wantDate \u003d new Date(today.getFullYear(), today.getMonth(), today.getDate());\n  wantDate.setDate(wantDate.getDate() + showDataDays);\n  for (var i \u003d 2; i \u003c lastRow; i++) {\n    if (userId \u003d\u003d sheetData[i][0] \u0026\u0026 new Date(sheetData[i][1]) \u003c wantDate \u0026\u0026 sheetData[i][3] \u003d\u003d 0 \u0026\u0026 sheetData[i][lastColumn - 1] !\u003d \"\") {\n      showData.push({rowNum:i + 1, alertDate:sheetData[i][1], alertContent:sheetData[i][2]});\n    }\n  }\n  //製作回應訊息\n  var replyMessage \u003d [];\n  if (showData.length \u003d\u003d 0) {\n    replyMessage.push({\n      \"type\": \"text\",\n      \"text\": \"很抱歉，找不到未來 \" + showDataDays + \" 日內尚未提醒的事項\"\n    });\n  }\n  else {\n    //將 showData 內的資料以時間來進行排序\n    showData \u003d showData.sort(function(a, b) {\n      return new Date(a.alertDate) \u003e new Date(b.alertDate)? 1:-1;\n    });\n    //製作 Flex Message\n    var flexMessage \u003d [];\n    for (var i \u003d 0; i \u003c showData.length; i++) {\n      var contentData \u003d showData[i].alertContent;\n      flexMessage.push({\n        \"type\": \"bubble\",\n        \"body\": {\n          \"type\": \"box\",\n          \"layout\": \"vertical\",\n          \"contents\": [\n            {\n              \"type\": \"text\",\n              \"text\": \"尚未提醒事項\",\n              \"weight\": \"bold\",\n              \"size\": \"xl\"\n            },\n            {\n              \"type\": \"box\",\n              \"layout\": \"vertical\",\n              \"margin\": \"xl\",\n              \"spacing\": \"xl\",\n              \"contents\": [\n                {\n                  \"type\": \"box\",\n                  \"layout\": \"baseline\",\n                  \"spacing\": \"xl\",\n                  \"contents\": [\n                    {\n                      \"type\": \"text\",\n                      \"text\": \"事件\",\n                      \"color\": \"#aaaaaa\",\n                      \"size\": \"lg\",\n                      \"flex\": 1\n                    },\n                    {\n                      \"type\": \"text\",\n                      \"text\": contentData.toString(),\n                      \"wrap\": true,\n                      \"color\": \"#666666\",\n                      \"size\": \"lg\",\n                      \"flex\": 5\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"box\",\n                  \"layout\": \"baseline\",\n                  \"spacing\": \"xl\",\n                  \"contents\": [\n                    {\n                      \"type\": \"text\",\n                      \"text\": \"時間\",\n                      \"color\": \"#aaaaaa\",\n                      \"size\": \"lg\",\n                      \"flex\": 1\n                    },\n                    {\n                      \"type\": \"text\",\n                      \"text\": showData[i].alertDate,\n                      \"wrap\": true,\n                      \"color\": \"#666666\",\n                      \"size\": \"lg\",\n                      \"flex\": 5\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        },\n        \"footer\": {\n          \"type\": \"box\",\n          \"layout\": \"vertical\",\n          \"spacing\": \"sm\",\n          \"contents\": [\n            {\n              \"type\": \"button\",\n              \"style\": \"primary\",\n              \"action\": {\n                \"type\": \"postback\",\n                \"label\": \"取消提醒\",\n                \"data\": deleteShowDataPostback + showData[i].rowNum\n              }\n            }\n          ]\n        }\n      });\n    }\n    replyMessage.push({\n      \"type\": \"text\",\n      \"text\": \"未來 \" + showDataDays + \" 日內尚有 \" + showData.length + \" 則未提醒事項，條列如下\"\n    },\n    {\n      \"type\": \"flex\",\n      \"altText\": \"未來 \" + showDataDays + \" 日內尚有 \" + showData.length + \" 則未提醒事項\",\n      \"contents\": {\n        \"type\": \"carousel\",\n        \"contents\": flexMessage\n      }\n    });\n  }\n  sendReplyMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage);\n}\nfunction checkDeleteShowData(CHANNEL_ACCESS_TOKEN, userId, deleteRowNum, replyToken){\n  if (sheetData[deleteRowNum - 1][0] !\u003d userId || sheetData[deleteRowNum - 1][3] !\u003d 0) {return;}\n  var contentData \u003d sheetData[deleteRowNum - 1][2];\n  var flexMessage \u003d [];\n  flexMessage.push({\n    \"type\": \"bubble\",\n    \"body\": {\n      \"type\": \"box\",\n      \"layout\": \"vertical\",\n      \"contents\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"確定要取消下列提醒？\",\n          \"weight\": \"bold\",\n          \"size\": \"xl\"\n        },\n        {\n          \"type\": \"box\",\n          \"layout\": \"vertical\",\n          \"margin\": \"xl\",\n          \"spacing\": \"xl\",\n          \"contents\": [\n            {\n              \"type\": \"box\",\n              \"layout\": \"baseline\",\n              \"spacing\": \"xl\",\n              \"contents\": [\n                {\n                  \"type\": \"text\",\n                  \"text\": \"事件\",\n                  \"color\": \"#aaaaaa\",\n                  \"size\": \"lg\",\n                  \"flex\": 1\n                },\n                {\n                  \"type\": \"text\",\n                  \"text\": contentData.toString(),\n                  \"wrap\": true,\n                  \"color\": \"#666666\",\n                  \"size\": \"lg\",\n                  \"flex\": 5\n                }\n              ]\n            },\n            {\n              \"type\": \"box\",\n              \"layout\": \"baseline\",\n              \"spacing\": \"xl\",\n              \"contents\": [\n                {\n                  \"type\": \"text\",\n                  \"text\": \"時間\",\n                  \"color\": \"#aaaaaa\",\n                  \"size\": \"lg\",\n                  \"flex\": 1\n                },\n                {\n                  \"type\": \"text\",\n                  \"text\": sheetData[deleteRowNum - 1][1],\n                  \"wrap\": true,\n                  \"color\": \"#666666\",\n                  \"size\": \"lg\",\n                  \"flex\": 5\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    \"footer\": {\n      \"type\": \"box\",\n      \"layout\": \"vertical\",\n      \"spacing\": \"sm\",\n      \"contents\": [\n        {\n          \"type\": \"button\",\n          \"style\": \"primary\",\n          \"action\": {\n            \"type\": \"postback\",\n            \"label\": \"確定取消提醒\",\n            \"data\": confirmDeleteShowDataPostback + deleteRowNum\n          }\n        }\n      ]\n    }\n  });\n  var replyMessage \u003d [];\n  replyMessage.push({\n    \"type\": \"flex\",\n    \"altText\": \"確認取消提醒事項\",\n    \"contents\": {\n      \"type\": \"carousel\",\n      \"contents\": flexMessage\n    }\n  });\n  sendReplyMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage);\n}\n//確認取消提醒事項\nfunction confirmDeleteShowData(CHANNEL_ACCESS_TOKEN, userId, deleteRowNum, replyToken){\n  if (sheetData[deleteRowNum - 1][0] !\u003d userId || sheetData[deleteRowNum - 1][3] !\u003d 0) {return;}\n  sheet.getRange(deleteRowNum, 4).setValue(1);\n  var contentData \u003d sheetData[deleteRowNum - 1][2];\n  var flexMessage \u003d [];\n  flexMessage.push({\n    \"type\": \"bubble\",\n    \"body\": {\n      \"type\": \"box\",\n      \"layout\": \"vertical\",\n      \"contents\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"下列事項已取消提醒\",\n          \"weight\": \"bold\",\n          \"size\": \"xl\"\n        },\n        {\n          \"type\": \"box\",\n          \"layout\": \"vertical\",\n          \"margin\": \"xl\",\n          \"spacing\": \"xl\",\n          \"contents\": [\n            {\n              \"type\": \"box\",\n              \"layout\": \"baseline\",\n              \"spacing\": \"xl\",\n              \"contents\": [\n                {\n                  \"type\": \"text\",\n                  \"text\": \"事件\",\n                  \"color\": \"#aaaaaa\",\n                  \"size\": \"lg\",\n                  \"flex\": 1\n                },\n                {\n                  \"type\": \"text\",\n                  \"text\": contentData.toString(),\n                  \"wrap\": true,\n                  \"color\": \"#666666\",\n                  \"size\": \"lg\",\n                  \"flex\": 5\n                }\n              ]\n            },\n            {\n              \"type\": \"box\",\n              \"layout\": \"baseline\",\n              \"spacing\": \"xl\",\n              \"contents\": [\n                {\n                  \"type\": \"text\",\n                  \"text\": \"時間\",\n                  \"color\": \"#aaaaaa\",\n                  \"size\": \"lg\",\n                  \"flex\": 1\n                },\n                {\n                  \"type\": \"text\",\n                  \"text\": sheetData[deleteRowNum - 1][1],\n                  \"wrap\": true,\n                  \"color\": \"#666666\",\n                  \"size\": \"lg\",\n                  \"flex\": 5\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  });\n  var replyMessage \u003d [];\n  replyMessage.push({\n    \"type\": \"flex\",\n    \"altText\": \"取消提醒事項\",\n    \"contents\": {\n      \"type\": \"carousel\",\n      \"contents\": flexMessage\n    }\n  });\n  sendReplyMessage(CHANNEL_ACCESS_TOKEN, replyToken, replyMessage);\n}\n//傳送 Line Notify 訊息\nfunction sendLineNotify(message, Line_Notify_Token){\n  var url \u003d \"https://notify-api.line.me/api/notify\";\n  var options \u003d\n   {\n     \"method\"  : \"post\",\n     \"payload\" : {\"message\" : message},\n     \"headers\" : {\"Authorization\" : \"Bearer \" + Line_Notify_Token}\n   };\n   UrlFetchApp.fetch(url, options);\n}\n//程式碼結束\n"}]}